#!/bin/bash
PYTHON="python3" # Pode-se modificar esta variavel, se necessario
PROGRAM="pword.py" # Nao pode modificar esta variavel
#TO-DO: Validar o n√∫mero de argumentos antes de chamar o Python (Ver TP02)
#TO-DO: Validar que o ficheiro $PROGRAM existe antes de chama-lo (Ver TP02)

file_counter=0
process_true=false
process_number=1
m_mode=c
w_word=""
txt_files=""

if [ ! -f "$PROGRAM" ]; then
    echo "Error: This program does not exist"
    exit 1
else
    # Check if any arguments were provided
    if [ $# -eq 0 ]; then
        echo "You need to provide arguments."
        exit 1
    else # Check if the right arguments were provided and selects the mode on how the word will be searched
        args=("$@")
        length=${#args[@]}
        for ((i=0; i<length; i++)); do
            arg="${args[i]}"
            if [ -f "$arg" ] && [[ "$arg" == *.txt ]]; then
                txt_files+="$arg " 
                ((file_count++))
            fi
            case $arg in 
                "-m")
                    m_mode="${args[i+1]}"
                    ;;
                "-w")
                    w_word="${args[i+1]}"
                    ;;
                "-p")
                    process_number="${args[i+1]}"
                    ;;
            esac      
        done
        if [ "$txt_files" = "" ] || [ "$w_word" = "" ] ; then
            echo "The arguments must include a "-w word" argument and a .txt argument."
            exit 1
        fi
    fi
fi

#Checks if the number of processes is greater or equal of the number of files
if [ "$process_number" -lt "$file_count" ];then
    echo "The number of processes needs to be more or equal the amount of files you give."
    exit 1
fi    
${PYTHON} ${PROGRAM} "$m_mode" "$process_number" "$w_word" $txt_files 
exit 0
